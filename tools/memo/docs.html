<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utilsly Docs - 문서 편집기</title>
    <meta name="description" content="HWP 스타일의 전문 문서 편집기입니다. 표, 이미지, PDF 내보내기를 지원합니다.">
    <link rel="stylesheet" href="../../css/style.css">
    <!-- Quill.js Theme -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        .editor-wrapper {
            background: #f0f0f0;
            padding: 40px 0;
            display: flex;
            justify-content: center;
            min-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 25mm;
            box-sizing: border-box;
            position: relative;
        }

        #editor {
            border: none;
            font-family: 'Malgun Gothic', sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            height: 100%;
        }

        .ql-toolbar {
            background: white;
            border: none !important;
            border-bottom: 1px solid var(--border-color) !important;
            position: sticky;
            top: 0;
            z-index: 100;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .ql-container {
            border: none !important;
            font-size: 16px;
            /* Default font size override */
        }

        .ql-editor {
            padding: 0;
            min-height: 250mm;
        }

        /* Dark Mode Overrides */
        [data-theme="dark"] .editor-wrapper {
            background: #1e1e1e;
        }

        [data-theme="dark"] .a4-page {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        [data-theme="dark"] .ql-toolbar {
            background: #2d2d2d;
            border-color: #444 !important;
        }

        [data-theme="dark"] .ql-stroke {
            stroke: #e0e0e0;
        }

        [data-theme="dark"] .ql-fill {
            fill: #e0e0e0;
        }

        [data-theme="dark"] .ql-picker {
            color: #e0e0e0;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }

            .a4-page,
            .a4-page * {
                visibility: visible;
            }

            .a4-page {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }

            .sidebar,
            .top-bar,
            .ql-toolbar {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar">U</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <!-- Sidebar content generated by js/common.js -->
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="breadcrumbs">
                    <span class="breadcrumb-item">Utilsly Docs</span>
                </div>
            </header>

            <div class="content-area"
                style="padding: 0; overflow: hidden; display: flex; flex-direction: column; height: calc(100vh - 60px);">
                <div class="page-header" style="padding: 24px 24px 0 24px; margin-bottom: 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="header-icon-wrapper" style="margin-bottom: 0;">
                                <span class="material-symbols-rounded">description</span>
                            </div>
                            <h1 style="margin: 0; font-size: 24px;">Utilsly Docs</h1>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn" onclick="exportPDF()">
                                <span class="material-symbols-rounded"
                                    style="font-size: 18px; margin-right: 4px;">picture_as_pdf</span>
                                PDF 저장
                            </button>
                            <button class="btn btn-primary" onclick="saveDoc()">
                                <span class="material-symbols-rounded"
                                    style="font-size: 18px; margin-right: 4px;">save</span>
                                저장
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Toolbar Container (Quill will inject here) -->
                <div id="toolbar-container">
                    <span class="ql-formats">
                        <select class="ql-font"></select>
                        <select class="ql-size"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                        <button class="ql-strike"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-list" value="ordered"></button>
                        <button class="ql-list" value="bullet"></button>
                        <button class="ql-indent" value="-1"></button>
                        <button class="ql-indent" value="+1"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-align"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-link"></button>
                        <button class="ql-image"></button>
                        <button class="ql-video"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-clean"></button>
                    </span>
                </div>

                <div class="editor-wrapper">
                    <div class="a4-page">
                        <div id="editor"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="../../js/common.js"></script>
    <!-- Quill.js -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        // Initialize Quill
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: '#toolbar-container'
            },
            placeholder: '내용을 입력하세요...'
        });

        // Load saved content
        const savedContent = localStorage.getItem('utilsly_docs_content');
        if (savedContent) {
            quill.root.innerHTML = savedContent;
        }

        // Save function
        function saveDoc() {
            localStorage.setItem('utilsly_docs_content', quill.root.innerHTML);
            alert('문서가 저장되었습니다.');
        }

        // Auto-save
        let timeoutId;
        quill.on('text-change', function () {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
                localStorage.setItem('utilsly_docs_content', quill.root.innerHTML);
            }, 2000);
        });

        // Export PDF
        function exportPDF() {
            const element = document.querySelector('.a4-page');
            const opt = {
                margin: 0,
                filename: 'document.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Temporarily remove shadow and margin for clean export
            const originalStyle = element.style.cssText;
            element.style.boxShadow = 'none';
            element.style.margin = '0';

            html2pdf().set(opt).from(element).save().then(() => {
                element.style.cssText = originalStyle;
            });
        }
    </script>
</body>

</html>