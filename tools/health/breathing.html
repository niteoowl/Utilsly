<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>호흡 운동 - Utilsly</title>
    <meta name="description" content="4-7-8 호흡법으로 스트레스를 줄이고 안정을 찾으세요.">
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        .breathing-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            position: relative;
        }

        .circle-container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circle {
            background: #E3F2FD;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            z-index: 1;
            transform: scale(0.3);
            transition: transform 4s ease-in-out;
        }

        .instruction {
            z-index: 2;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
        }

        .timer-text {
            font-size: 16px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .controls {
            margin-top: 40px;
        }

        /* Animation States */
        .circle.inhale {
            transform: scale(1);
            background: #BBDEFB;
            transition-duration: 4s;
            /* 4초 들이마시기 */
        }

        .circle.hold {
            transform: scale(1);
            background: #90CAF9;
            transition-duration: 0s;
            /* 멈춤 */
        }

        .circle.exhale {
            transform: scale(0.3);
            background: #E3F2FD;
            transition-duration: 8s;
            /* 8초 내뱉기 */
        }

        [data-theme="dark"] .circle {
            background: #1e3a5f;
        }

        [data-theme="dark"] .circle.inhale {
            background: #2b5285;
        }

        [data-theme="dark"] .circle.hold {
            background: #386ab0;
        }

        [data-theme="dark"] .circle.exhale {
            background: #1e3a5f;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar">U</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <!-- Sidebar content generated by js/common.js -->
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="breadcrumbs">
                    <span class="breadcrumb-item">호흡 운동</span>
                </div>
            </header>

            <div class="content-area">
                <div class="page-header">
                    <div class="header-icon-wrapper">
                        <span class="material-symbols-rounded">self_improvement</span>
                    </div>
                    <h1>호흡 운동 (4-7-8)</h1>
                    <p class="description">4초간 들이마시고, 7초간 멈추고, 8초간 내뱉으며 안정을 찾으세요.</p>
                </div>

                <div class="tool-container">
                    <div class="breathing-container">
                        <div class="circle-container">
                            <div class="circle" id="circle"></div>
                            <div style="text-align: center; z-index: 2;">
                                <div class="instruction" id="instruction">준비</div>
                                <div class="timer-text" id="timerText">시작하려면 버튼을 누르세요</div>
                            </div>
                        </div>

                        <div class="controls">
                            <button class="btn btn-primary" id="startBtn" onclick="toggleBreathing()"
                                style="padding: 12px 32px; font-size: 18px;">
                                시작하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="../../js/common.js"></script>
    <script>
        let isRunning = false;
        let timeoutId;
        const circle = document.getElementById('circle');
        const instruction = document.getElementById('instruction');
        const timerText = document.getElementById('timerText');
        const startBtn = document.getElementById('startBtn');

        function toggleBreathing() {
            if (isRunning) {
                stopBreathing();
            } else {
                startBreathing();
            }
        }

        function startBreathing() {
            isRunning = true;
            startBtn.textContent = '중지하기';
            startBtn.style.background = '#FF4B4B';
            startBtn.style.borderColor = '#FF4B4B';

            runCycle();
        }

        function stopBreathing() {
            isRunning = false;
            clearTimeout(timeoutId);
            startBtn.textContent = '시작하기';
            startBtn.style.background = ''; // Reset to default
            startBtn.style.borderColor = '';

            circle.className = 'circle';
            instruction.textContent = '준비';
            timerText.textContent = '시작하려면 버튼을 누르세요';
        }

        function runCycle() {
            if (!isRunning) return;

            // Inhale (4s)
            instruction.textContent = '들이마시기';
            timerText.textContent = '4초';
            circle.className = 'circle inhale';

            timeoutId = setTimeout(() => {
                if (!isRunning) return;

                // Hold (7s)
                instruction.textContent = '멈추기';
                timerText.textContent = '7초';
                circle.className = 'circle hold';

                timeoutId = setTimeout(() => {
                    if (!isRunning) return;

                    // Exhale (8s)
                    instruction.textContent = '내뱉기';
                    timerText.textContent = '8초';
                    circle.className = 'circle exhale';

                    timeoutId = setTimeout(() => {
                        if (!isRunning) return;
                        runCycle(); // Repeat
                    }, 8000);

                }, 7000);

            }, 4000);
        }
    </script>
</body>

</html>