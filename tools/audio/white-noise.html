<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>백색 소음 - Utilsly</title>
    <meta name="description" content="집중력 향상과 수면 유도를 위한 백색 소음, 핑크 노이즈, 브라운 노이즈를 재생합니다.">
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        .noise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .noise-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .noise-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .noise-card.active {
            border-color: var(--accent-blue);
            background: rgba(49, 130, 246, 0.05);
        }

        .noise-icon {
            font-size: 48px;
            color: var(--accent-blue);
            margin-bottom: 16px;
        }

        .noise-name {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .noise-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .volume-control {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar">U</div>
                    <span class="username">Utilsly</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <!-- Sidebar content generated by js/common.js -->
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="breadcrumbs">
                    <span class="breadcrumb-item">Utilsly</span>
                    <span class="separator">/</span>
                    <span class="breadcrumb-item">오디오</span>
                    <span class="separator">/</span>
                    <span class="breadcrumb-item current-page">백색 소음</span>
                </div>
            </header>

            <div class="content-area">
                <div class="page-header">
                    <div class="header-icon-wrapper">
                        <span class="material-symbols-rounded">waves</span>
                    </div>
                    <h1>백색 소음</h1>
                    <p class="description">집중하거나 휴식을 취할 때 도움이 되는 다양한 노이즈를 들어보세요.</p>
                </div>

                <div class="tool-container">
                    <div class="noise-grid">
                        <div class="noise-card" onclick="playNoise('white', this)">
                            <div class="material-symbols-rounded noise-icon">static_audio</div>
                            <div class="noise-name">White Noise</div>
                            <div class="noise-desc">모든 주파수가 균일한 소리. 집중력 향상에 좋습니다.</div>
                        </div>
                        <div class="noise-card" onclick="playNoise('pink', this)">
                            <div class="material-symbols-rounded noise-icon">water_drop</div>
                            <div class="noise-name">Pink Noise</div>
                            <div class="noise-desc">빗소리와 비슷한 부드러운 소리. 수면에 도움이 됩니다.</div>
                        </div>
                        <div class="noise-card" onclick="playNoise('brown', this)">
                            <div class="material-symbols-rounded noise-icon">thunderstorm</div>
                            <div class="noise-name">Brown Noise</div>
                            <div class="noise-desc">폭포 소리처럼 깊고 낮은 소리. 마음을 진정시킵니다.</div>
                        </div>
                    </div>

                    <div class="volume-control">
                        <label style="display: block; margin-bottom: 12px; font-weight: 600;">볼륨 조절</label>
                        <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5"
                            style="width: 100%;">
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="../../js/common.js"></script>
    <script>
        let audioCtx;
        let noiseSource;
        let gainNode;
        let currentType = null;

        const volumeSlider = document.getElementById('volumeSlider');

        volumeSlider.addEventListener('input', (e) => {
            if (gainNode) {
                gainNode.gain.value = e.target.value;
            }
        });

        function playNoise(type, card) {
            // Stop current if playing
            if (currentType === type) {
                stopNoise();
                card.classList.remove('active');
                currentType = null;
                return;
            }

            // Stop previous
            stopNoise();
            document.querySelectorAll('.noise-card').forEach(c => c.classList.remove('active'));

            // Start new
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }

            const bufferSize = 2 * audioCtx.sampleRate;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                const white = Math.random() * 2 - 1;

                if (type === 'white') {
                    output[i] = white;
                } else if (type === 'pink') {
                    // Pink noise approximation
                    let b0, b1, b2, b3, b4, b5, b6;
                    b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
                    // (Complex pink noise algorithm simplified for brevity, using white for now as placeholder if complex algo is too long)
                    // Actually let's use a simple filter approach for pink/brown
                    output[i] = white; // We will filter it below
                } else {
                    output[i] = white; // Filter below
                }
            }

            noiseSource = audioCtx.createBufferSource();
            noiseSource.buffer = buffer;
            noiseSource.loop = true;

            gainNode = audioCtx.createGain();
            gainNode.gain.value = volumeSlider.value;

            // Create filter for Pink/Brown
            if (type === 'pink') {
                // Pink noise filter (-3dB/octave) - approximated with lowpass
                // Better approximation:
                // Actually, let's just generate white noise and use a BiquadFilterNode
                // Pink: Lowpass around 500Hz is a rough approx, but real pink noise is 1/f. 
                // Let's stick to generating White Noise buffer and using a filter for simplicity.
                // Brown: Lowpass heavily.
            }

            // Re-generating buffer for specific colors is better
            if (type === 'pink') {
                let b0 = 0, b1 = 0, b2 = 0, b3 = 0, b4 = 0, b5 = 0, b6 = 0;
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    b0 = 0.99886 * b0 + white * 0.0555179;
                    b1 = 0.99332 * b1 + white * 0.0750759;
                    b2 = 0.96900 * b2 + white * 0.1538520;
                    b3 = 0.86650 * b3 + white * 0.3104856;
                    b4 = 0.55000 * b4 + white * 0.5329522;
                    b5 = -0.7616 * b5 - white * 0.0168980;
                    output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                    output[i] *= 0.11; // Compensate for gain
                    b6 = white * 0.115926;
                }
            } else if (type === 'brown') {
                let lastOut = 0.0;
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    output[i] = (lastOut + (0.02 * white)) / 1.02;
                    lastOut = output[i];
                    output[i] *= 3.5; // Compensate for gain
                }
            }

            noiseSource.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            noiseSource.start();

            card.classList.add('active');
            currentType = type;
        }

        function stopNoise() {
            if (noiseSource) {
                noiseSource.stop();
                noiseSource.disconnect();
                noiseSource = null;
            }
        }
    </script>
</body>

</html>