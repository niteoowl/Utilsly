<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 색상 추출 - Utilsly</title>
    <meta name="description" content="이미지에서 주요 색상 팔레트를 추출하세요.">
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        .extractor-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            object-fit: contain;
            background: #f0f0f0;
            display: none;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 16px;
        }

        .color-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .color-preview {
            height: 80px;
            width: 100%;
        }

        .color-info {
            padding: 8px;
            text-align: center;
            font-family: var(--font-mono);
            font-size: 12px;
        }

        .dominant-color-section {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 24px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .dominant-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .color-card,
        [data-theme="dark"] .dominant-color-section {
            background: var(--bg-sidebar);
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="avatar">U</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <!-- Sidebar content generated by js/common.js -->
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="breadcrumbs">
                    <span class="breadcrumb-item">이미지 색상 추출</span>
                </div>
            </header>

            <div class="content-area">
                <div class="page-header">
                    <div class="header-icon-wrapper">
                        <span class="material-symbols-rounded">palette</span>
                    </div>
                    <h1>이미지 색상 추출</h1>
                    <p class="description">이미지를 업로드하여 주요 색상과 팔레트를 추출하세요.</p>
                </div>

                <div class="tool-container">
                    <div class="drop-zone" id="dropZone"
                        style="border: 2px dashed var(--border-color); padding: 40px; text-align: center; cursor: pointer; margin-bottom: 24px;">
                        <span class="material-symbols-rounded"
                            style="font-size: 48px; color: var(--text-tertiary);">add_photo_alternate</span>
                        <p style="margin-top: 16px;">이미지를 업로드하세요</p>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    </div>

                    <div id="resultArea" style="display: none;">
                        <img id="targetImage" class="image-preview" alt="Uploaded Image">

                        <h3 style="margin: 24px 0 16px;">대표 색상 (Dominant Color)</h3>
                        <div class="dominant-color-section">
                            <div id="dominantPreview" class="dominant-preview"></div>
                            <div>
                                <div id="dominantHex" style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">
                                    #000000</div>
                                <div id="dominantRgb" style="color: var(--text-secondary);">rgb(0, 0, 0)</div>
                            </div>
                        </div>

                        <h3 style="margin: 24px 0 16px;">색상 팔레트 (Palette)</h3>
                        <div class="palette-grid" id="paletteGrid"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="../../js/common.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const resultArea = document.getElementById('resultArea');
        const targetImage = document.getElementById('targetImage');
        const dominantPreview = document.getElementById('dominantPreview');
        const dominantHex = document.getElementById('dominantHex');
        const dominantRgb = document.getElementById('dominantRgb');
        const paletteGrid = document.getElementById('paletteGrid');

        const colorThief = new ColorThief();

        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) processImage(e.target.files[0]);
        });

        function processImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                targetImage.src = e.target.result;
                targetImage.style.display = 'block';
                resultArea.style.display = 'block';
                dropZone.style.display = 'none';

                // Wait for image load
                targetImage.onload = () => {
                    extractColors();
                };
            };
            reader.readAsDataURL(file);
        }

        function extractColors() {
            // Dominant Color
            const color = colorThief.getColor(targetImage);
            updateDominantColor(color);

            // Palette
            const palette = colorThief.getPalette(targetImage, 10);
            updatePalette(palette);
        }

        function updateDominantColor(color) {
            const rgb = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
            const hex = rgbToHex(color[0], color[1], color[2]);

            dominantPreview.style.backgroundColor = rgb;
            dominantHex.textContent = hex;
            dominantRgb.textContent = rgb;
        }

        function updatePalette(palette) {
            paletteGrid.innerHTML = '';
            palette.forEach(color => {
                const rgb = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
                const hex = rgbToHex(color[0], color[1], color[2]);

                const card = document.createElement('div');
                card.className = 'color-card';
                card.innerHTML = `
                    <div class="color-preview" style="background-color: ${rgb}"></div>
                    <div class="color-info">
                        <div style="font-weight: 600;">${hex}</div>
                        <div style="color: var(--text-tertiary); font-size: 10px;">${rgb}</div>
                    </div>
                `;
                card.onclick = () => {
                    navigator.clipboard.writeText(hex);
                    alert(`복사됨: ${hex}`);
                };
                paletteGrid.appendChild(card);
            });
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        }
    </script>
</body>

</html>